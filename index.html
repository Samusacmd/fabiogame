<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phaser 3 – Preset + Asset personalizzati</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #0b0e14;
      color: #eaeaea;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
    }
    #game {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    .panel {
      position: fixed;
      top: 12px;
      left: 12px;
      background: rgba(0, 0, 0, .35);
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 14px;
      backdrop-filter: blur(6px);
    }
    .touch-ui {
      padding: 0 env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
</head>
<body>
<div id="game"></div>

<!-- UI touch -->
<div class="touch-ui" style="position:fixed; inset:0; pointer-events:none;">
  <div id="joy" style="position:absolute; left:24px; bottom:24px; width:140px; height:140px; pointer-events:auto; touch-action:none;">
    <div id="joy-base" style="position:absolute; left:0; top:0; width:140px; height:140px; border-radius:70px; background:rgba(255,255,255,0.1); border:2px solid rgba(255,255,255,0.2);"></div>
    <div id="joy-knob" style="position:absolute; left:55px; top:55px; width:30px; height:30px; border-radius:15px; background:rgba(255,255,255,0.35); border:2px solid rgba(255,255,255,0.6);"></div>
  </div>
  <div id="fire" style="position:absolute; right:24px; bottom:40px; width:96px; height:96px; border-radius:48px; pointer-events:auto; touch-action:none; background:rgba(255,255,255,0.1); border:2px solid rgba(255,255,255,0.25); display:flex; align-items:center; justify-content:center;">
    <span style="font: 600 16px system-ui; color:#eaeaea; user-select:none;">SPARA</span>
  </div>
  <label id="autofire" style="position:absolute; right:24px; bottom:144px; display:flex; gap:8px; align-items:center; pointer-events:auto; user-select:none;">
    <input type="checkbox" id="autofireChk">
    <span style="font: 600 14px system-ui; color:#eaeaea;">Auto-fire</span>
  </label>
  <button id="pauseBtn" style="position:absolute; right:18px; top:12px; width:44px; height:44px; border-radius:22px; pointer-events:auto; touch-action:none; background:rgba(255,255,255,0.12); border:2px solid rgba(255,255,255,0.25); color:#eaeaea; font: 700 16px system-ui;">⏸</button>
</div>

<script>
/* joystick + fire button handling */
var TOUCH={moveX:0,moveY:0,fire:false,auto:false};
(function(){
  var joy=document.getElementById('joy');
  var knob=document.getElementById('joy-knob');
  var fire=document.getElementById('fire');
  var pauseBtn=document.getElementById('pauseBtn');
  var chk=document.getElementById('autofireChk');
  chk.addEventListener('change',function(){TOUCH.auto=!!this.checked;});
  var activeId=null,center={x:70,y:70},radius=60;
  function setKnob(dx,dy){knob.style.left=(center.x+dx-15)+'px';knob.style.top=(center.y+dy-15)+'px';}
  function updateFromPoint(cx,cy){
    var r=joy.getBoundingClientRect(),x=cx-r.left,y=cy-r.top,dx=x-center.x,dy=y-center.y,mag=Math.hypot(dx,dy);
    if(mag>radius){dx=dx*radius/mag;dy=dy*radius/mag;}
    setKnob(dx,dy);
    var nx=dx/radius,ny=dy/radius,dz=.15;
    TOUCH.moveX=(Math.abs(nx)<dz)?0:nx;TOUCH.moveY=(Math.abs(ny)<dz)?0:ny;
  }
  function resetStick(){setKnob(0,0);TOUCH.moveX=0;TOUCH.moveY=0;}
  joy.addEventListener('pointerdown',function(e){joy.setPointerCapture(e.pointerId);activeId=e.pointerId;updateFromPoint(e.clientX,e.clientY);e.preventDefault();});
  joy.addEventListener('pointermove',function(e){if(activeId!==e.pointerId)return;updateFromPoint(e.clientX,e.clientY);e.preventDefault();});
  function joyEnd(e){if(activeId!==e.pointerId)return;activeId=null;resetStick();e.preventDefault();}
  joy.addEventListener('pointerup',joyEnd);joy.addEventListener('pointercancel',joyEnd);joy.addEventListener('lostpointercapture',joyEnd);
  var fireId=null;function fireOn(e){TOUCH.fire=true;fire.style.background='rgba(255,255,255,0.2)';e.preventDefault();}
  function fireOff(e){TOUCH.fire=false;fire.style.background='rgba(255,255,255,0.1)';e.preventDefault();}
  fire.addEventListener('pointerdown',function(e){fireId=e.pointerId;fireOn(e);});
  fire.addEventListener('pointerup',function(e){if(fireId===e.pointerId)fireOff(e);});
  fire.addEventListener('pointercancel',function(e){if(fireId===e.pointerId)fireOff(e);});
  fire.addEventListener('lostpointercapture',function(e){if(fireId===e.pointerId)fireOff(e);});
  pauseBtn.addEventListener('click',function(e){try{if(window.GPAUSE)window.GPAUSE();}catch(_){}e.preventDefault();});
  ['touchstart','touchmove','touchend'].forEach(function(t){document.addEventListener(t,function(ev){ev.preventDefault();},{passive:false});});
})();
</script>

<div class="panel"><strong>Comandi:</strong> WASD/frecce, Spazio spara, P pausa, R restart.</div>

<script>
/* ============== CONFIGURAZIONE ============== */
var W=900, H=600;  // risoluzione logica (resta fissa, Phaser farà il fit automatico)
/* ... qui resta TUTTO il codice del gioco identico a quello che avevi ... */

/* === ALLA FINE sostituisci la creazione del gioco con questa === */
new Phaser.Game({
  type: Phaser.AUTO,
  width: W,
  height: H,
  parent: 'game',
  backgroundColor: '#0b0e14',
  physics: {
    default: 'arcade',
    arcade: { gravity: { y: 0 }, debug: false }
  },
  scene: [Boot, Main],
  scale: {
    mode: Phaser.Scale.FIT,       // <-- adattamento automatico
    autoCenter: Phaser.Scale.CENTER_BOTH
  }
});
</script>
</body>
</html>
